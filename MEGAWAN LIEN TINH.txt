10.61.4.68			FE 0/0/2   	*NH-EXiMBANK NGUYEN-VAN-TROI*

Con SW01 10.61.4.68 (GE 24 - GE23) đấu sau con SW02 10.61.4.198  lên UPE DALAT (ge-8/2/5 -> ae10)

-----------------------------10.61.4.68-------------------------
bridge 
vlan create 996
!
vlan add br996 24 tagged
vlan add br996 2 untagged
!
vlan pvid 2 996
!
port description 2 *NH-EXiMBANK NGUYEN-VAN-TROI*
!

---------------------------10.61.4.198-------------------------

bridge			//Khai TRUNK 
 trunk 0 19,24
 trunk distmode 0 srcmac

mvr
mvr port 1-18,20-23 type receiver
mvr port 19,24,29 type source
mvr vlan 99 group 232.84.1.1-232.84.1.254
mvr vlan 99 group 232.84.2.1-232.84.2.254
mvr vlan 99 group 232.84.3.1-232.84.3.254

vlan create 996
!
vlan add br996 23,29 tagged
!

======================UPE DALAT==============================

tritm.ldg@MX2010-LDG08DLT_RE0> show configuration | display set | match ge-8/2/5    
set interfaces ge-8/2/5 description " 1G LDG08DLT_RE0 ge-8/2/5 10.61.4.198 G19"
set interfaces ge-8/2/5 hold-time up 5000
set interfaces ge-8/2/5 hold-time down 0
set interfaces ge-8/2/5 link-mode full-duplex
set interfaces ge-8/2/5 gigether-options auto-negotiation
set interfaces ge-8/2/5 gigether-options 802.3ad ae10

tritm.ldg@MX2010-LDG08DLT_RE0> show configuration | display set | match ae10   
set interfaces ge-8/2/5 gigether-options 802.3ad ae10
set interfaces ae10 description " 10.61.4.198 "
set interfaces ae10 flexible-vlan-tagging
set interfaces ae10 mtu 9022
set interfaces ae10 encapsulation flexible-ethernet-services
set interfaces ae10 unit 99 description "** Connect to LDG.DCT.TVT.L2S.V01.001 ** - SVLAN:99"
set interfaces ae10 unit 99 vlan-id 99
set interfaces ae10 unit 99 family inet policer arp POLICER_ARP_MyTV
set interfaces ae10 unit 99 family inet unnumbered-address lo0.0
set interfaces ae10 unit 996 description "** Connect to LDG.DCT.TVT.L2S.V01.002 ** - SVLAN:996"
set interfaces ae10 unit 996 encapsulation vlan-vpls
set interfaces ae10 unit 996 vlan-id 996
set interfaces ae10 unit 996 input-vlan-map push
set interfaces ae10 unit 996 input-vlan-map vlan-id 4094
set interfaces ae10 unit 996 output-vlan-map pop

set routing-instances L2-METRO_NT_EXIMBANK interface ae10.996

tritm.ldg@MX2010-LDG08DLT_RE0> show configuration | display set | match L2-METRO_NT_EXIMBANK 
set routing-instances L2-METRO_NT_EXIMBANK instance-type vpls
set routing-instances L2-METRO_NT_EXIMBANK interface ae10.996
set routing-instances L2-METRO_NT_EXIMBANK forwarding-options family vpls flood input BUM-METRO_NT_EXIMBANK
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls encapsulation-type ethernet-vlan
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls bum-hashing
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls enable-mac-move-action
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls no-tunnel-services
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls vpls-id 1600100996					//16: dịch vụ L2 E-LAN, 001: địa chỉ loopback gần, 0 số thứ tự của AAG
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls no-vlan-id-validate					//099 thông thường lấy luôn vlan, 6 đường chính or phụ đáng lẽ là 0 or 1 =>160019960 mới đúng
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls mesh-group NO-SPLIT local-switching
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls mesh-group NO-SPLIT neighbor 123.29.47.1 pseudowire-status-tlv

tritm.ldg@MX2010-LDG08DLT_RE0> show configuration | display set | match BUM-METRO_NT_EXIMBANK   
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term broadcast-traffic from traffic-type broadcast
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term broadcast-traffic then policer POLICER-BCAST
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term broadcast-traffic then accept
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term multicast-traffic from traffic-type multicast
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term multicast-traffic then policer POLICER-MCAST
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term multicast-traffic then accept
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term unknown-unicast-traffic from traffic-type unknown-unicast
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term unknown-unicast-traffic then policer POLICER-BCAST
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term unknown-unicast-traffic then accept
set routing-instances L2-METRO_NT_EXIMBANK forwarding-options family vpls flood input BUM-METRO_NT_EXIMBANK

=====================KHAI TREN AGG=======================================

set routing-instances L2-METRO_NT_EXIMBANK protocols vpls vpls-id 1600100996

tritm.ldg@MX2010-LDG00DLT_RE0> show configuration | display set | match L2-METRO_NT_EXIMBANK 
set routing-instances L2-METRO_NT_EXIMBANK instance-type vpls
set routing-instances L2-METRO_NT_EXIMBANK forwarding-options family vpls flood input BUM-METRO_NT_EXIMBANK
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls encapsulation-type ethernet-vlan
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls bum-hashing
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls no-tunnel-services
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls vpls-id 1600100996
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls no-vlan-id-validate
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls mesh-group NO-SPLIT local-switching
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls mesh-group NO-SPLIT neighbor 123.29.47.18 pseudowire-status-tlv
set routing-instances L2-METRO_NT_EXIMBANK protocols vpls mesh-group NO-SPLIT neighbor 123.29.47.25 pseudowire-status-tlv

{master}
tritm.ldg@MX2010-LDG00DLT_RE0> show configuration | display set | match BUM-METRO_NT_EXIMBANK   
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term broadcast-traffic from traffic-type broadcast
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term broadcast-traffic then policer POLICER-BCAST
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term broadcast-traffic then accept
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term multicast-traffic from traffic-type multicast
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term multicast-traffic then policer POLICER-MCAST
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term multicast-traffic then accept
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term unknown-unicast-traffic from traffic-type unknown-unicast
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term unknown-unicast-traffic then policer POLICER-BCAST
set firewall family vpls filter BUM-METRO_NT_EXIMBANK term unknown-unicast-traffic then accept
set routing-instances L2-METRO_NT_EXIMBANK forwarding-options family vpls flood input BUM-METRO_NT_EXIMBANK


====================KIEM TRA================
1. TREN AGG
 tritm.ldg@MX2010-LDG08DLT_RE0> show vpls mac-table instance L2-METRO_NT_EXIMBANK
 MAC                 MAC      Logical          NH     RTR
   addresssss          flags    interface        Index  ID
   00:1d:a2:c2:9c:c4   D        lsi.1051553     
   00:1e:7a:e1:1a:90   D        lsi.1051480     

2. TREN UPE
tritm.ldg@MX2010-LDG08DLT_RE0> show vpls mac-table instance L2-METRO_NT_EXIMBANK
 MAC                 MAC      Logical          NH     RTR
MAC                 MAC      Logical          NH     RTR
   addresssss          flags    interface        Index  ID
   00:1d:a2:c2:9c:c4   D        lsi.1049117     
   00:1e:7a:e1:1a:90   D        ae10.996        
   00:21:a0:bb:f1:50   D        ae10.996 

3. TREN SW 10.61.4.198
LDG.DCT.TVT.L2S.V01.001# show mac 996
==================================================================
port    mac addr              permission     status      in use
==================================================================
eth23   00:1e:7a:e1:1a:90     OK             dynamic       0.29
eth29   00:1d:a2:c2:9c:c4     OK             dynamic       8.29

4. TREN SW 10.61.4.68
LDG.DCT.TVT.L2S.V01.002# show mac 996
==================================================================
port    mac addr              permission     status      in use
==================================================================
eth02   00:21:a0:bb:f1:50     OK             dynamic      72.01
eth02   00:1e:7a:e1:1a:90     OK             dynamic     232.01
eth24   00:1d:a2:c2:9c:c4     OK             dynamic      72.01